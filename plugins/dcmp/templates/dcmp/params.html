{% extends "airflow/master.html" %}

{% block title %}Params{% endblock %}

{% block head %}
    {{ super() }}
    <style type="text/css">
        .wy-table-responsive {
            margin-bottom: 24px;
            max-width: 100%;
            overflow: auto;
        }
        table.docutils {
            border: 1px solid #e1e4e5;
        }
        .wy-table-bordered-all table.docutils {
            border-collapse: collapse;
            border-spacing: 0;
            empty-cells: show;
            margin-bottom: 24px;
        }
        
        code.literal {
            color: #E74C3C;
        }
        
        code {
            white-space: nowrap;
            max-width: 100%;
            background: #fff;
            border: solid 1px #e1e4e5;
            font-size: 75%;
            padding: 2px 5px;
            font-family: Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;
            color: #E74C3C;
            overflow-x: auto;
        }
        
        table.docutils thead{
            color: #000;
            text-align: left;
            vertical-align: bottom;
            white-space: nowrap;
            border-collapse: collapse;
            border-spacing: 0;
            empty-cells: show;
            margin-bottom: 24px;
        }
        table.docutils th:first-child{
            border-left-width: 0;
        }
        table.docutils thead th{
            font-weight: bold;
            border-bottom: solid 2px #e1e4e5;
            background-color: white;
        }
        table.docutils th,td{
            font-size: 90%;
            margin: 0;
            overflow: visible;
            padding: 8px 16px;
        }
        table.docutils:not(.field-list) tr:nth-child(2n-1) td {
            background-color: #f3f6f6;
        }
        
        table.docutils td {
            border-bottom: 1px solid #e1e4e5;
            border-left: 1px solid #e1e4e5;
        }
        table.docutils td{
            background-color: transparent;
            vertical-align: middle;
        }
        .wy-table-responsive table td{
            white-space: nowrap;
        }
    </style>
{% endblock %}

{% block body %}
{% raw %}
<div id="main-container" class="container">
    <h2>Params</h2>
    <div class="wy-table-responsive">
        <table border="1" class="docutils">
            <colgroup>
                <col width="38%">
                <col width="62%">
            </colgroup>
            <thead valign="bottom">
                <tr class="row-odd">
                <th class="head">分类</th>
                <th class="head">Variable</th>
                <th class="head">Description</th>
            </tr>
            </thead>
            <tbody valign="top">


                <tr class="row-even">
                    <td>动态execution_date</td>
                    <td>
                        <code class="docutils literal">
                            <span class="pre">{{</span><span class="pre"> (execution_date + macros.dateutil.relativedelta.relativedelta(days=+0)).strftime("%Y-%m-%d") </span><span class="pre">}}</span>
                        </code>
                    </td>
                    <td>操作日execution_date
                        <code class="docutils literal">
                            <span class="pre">YYYY-MM-DD</span></code>
                    </td>
                </tr>

                <tr class="row-odd">
                    <td>动态execution_date</td>
                    <td>
                        <code class="docutils literal">
                            <span class="pre">{{</span><span class="pre"> (execution_date + macros.dateutil.relativedelta.relativedelta(day=-1)).strftime("%Y-%m-%d") </span><span class="pre">}}</span>
                        </code>
                    </td>
                    <td>操作日的前1天
                        <code class="docutils literal">
                            <span class="pre">YYYY-MM-DD</span></code>
                    </td>
                </tr>

                <tr class="row-even">
                    <td>动态execution_date</td>
                    <td>
                        <code class="docutils literal">
                            <span class="pre">{{</span><span class="pre"> (execution_date + macros.dateutil.relativedelta.relativedelta(day=1,months=+1,days=-1)).strftime("%Y-%m-%d") </span><span class="pre">}}</span>
                        </code>
                    </td>
                    <td>操作日的当月最后1天
                        <code class="docutils literal">
                            <span class="pre">YYYY-MM-DD</span></code>
                    </td>
                </tr>

                <tr class="row-odd">
                    <td>动态execution_date</td>
                    <td>
                        <code class="docutils literal">
                            <span class="pre">{{</span><span class="pre"> (execution_date + macros.dateutil.relativedelta.relativedelta(day=1,months=+1,days=-1)).strftime("%Y-%m-%d %H:%M:%S") </span><span class="pre">}}</span>
                        </code>
                    </td>
                    <td>操作日的当月最后1天
                        <code class="docutils literal">
                            <span class="pre">YYYY-MM-DD HH:MI:DD</span></code>
                    </td>
                </tr>


                <tr class="row-even">
                    <td>动态当前日期+时间</td>
                    <td>
                        <code class="docutils literal">
                            <span class="pre">{{</span><span class="pre">params.now</span><span class="pre">}}</span>
                        </code>
                    </td>
                    <td>今天+时间
                        <code class="docutils literal">
                            <span class="pre">YYYY-MM-DD HH:MI:SS</span></code>
                    </td>
                </tr>
                <tr class="row-odd">
                    <td>动态当前日期+时间</td>
                    <td>
                        <code class="docutils literal">
                            <span class="pre">{{ params.today }},{{ params.yesterday }},{{ params.tomorrow }}</span>
                        </code>
                    </td>
                    <td>今天,昨天,明天
                        <code class="docutils literal">
                            <span class="pre">YYYY-MM-DD</span></code>
                    </td>
                </tr>
                <tr class="row-even">
                    <td>动态当前日期+时间</td>
                    <td>
                        <code class="docutils literal">
                            <span class="pre">{{ params.this_month }},{{ params.last_month }},{{ params.next_month }}</span>
                        </code>
                    </td>
                    <td>当月,上一月,下一月
                        <code class="docutils literal">
                            <span class="pre">YYYY-MM</span></code>
                    </td>
                </tr>
                <tr class="row-odd">
                    <td>动态当前日期+时间</td>
                    <td>
                        <code class="docutils literal">
                            <span class="pre">{{ params.this_month_first_day }},{{ params.last_month_first_day }},{{ params.next_month_last_day }}</span>
                        </code>
                    </td>
                    <td>当月第1天,上一月第1天,下一月第1天
                        <code class="docutils literal">
                            <span class="pre">YYYY-MM-DD</span></code>
                    </td>
                </tr>
                <tr class="row-even">
                    <td>动态当前日期+时间</td>
                    <td>
                        <code class="docutils literal">
                            <span class="pre">{{ params.this_year }},{{ params.last_year }},{{ params.next_year }}</span>
                        </code>
                    </td>
                    <td>今年,去年,明年
                        <code class="docutils literal">
                            <span class="pre">YYYY-MM-DD</span></code>
                    </td>
                </tr>
             
                </tr>
            </tbody>
        </table>
    </div>
</div>



<div id="main-container" class="container">
    <h2>Wait Task Instance 解释</h2>
    <div class="wy-table-responsive">
        <table border="1" class="docutils">
            <colgroup>
                <col width="38%">
                <col width="62%">
            </colgroup>
            <thead valign="bottom">
                <tr class="row-odd">
                <th class="head">分类</th>
                <th class="head">说明</th>
            </tr>
            </thead>
            <tbody valign="top">


                <tr class="row-even">
                    <td>含义</td>
                    <td>
依赖条件:dag_id.task_id在时间范围内[execution_date_begin,execution_date_end){左开右闭}是否有运行成功过<br>
循环等待的overtime_num次数,超时后则失败<br>
frequency:为预定义的类型,当此值不为custom,则可决定execution_date_begin,execution_date_end对应的值;<br>
例,当frequency=hourly,execution_date='2017-02-04 05:06:07',则可决定execution_date_begin='2017-02-04 05:00:00',execution_date_end='2017-02-04 06:00:00'<br>
                    </td>
                </tr>

                <tr class="row-odd">
                    <td>说明</td>
                    <td>
设置字典类型的变量waits<br>
waits['dag_id'],必填,依赖的dag_id<br>
waits['task_id'],必填,依赖的task_id<br>
waits['frequency'],可选,取值=(daily,last_daily,monthly,last_monthly,yearly,last_yearly,hourly,custom;缺省为daily)<br>
waits['execution_date'],可选,缺省值为本dag_id的运行动态execution_date,建议不填写<br>
waits['overtime_num'],可选,循环等待的次数(每次1分钟)，缺省为1440，即1天<br>
waits['execution_date_begin'],可选,当frequency=custom时,建议使用dag_id的运行动态execution_date相关<br>
waits['execution_date_end'],可选,建议使用dag_id的运行动态execution_date相关<br>
                    </td>

                </tr>

                <tr class="row-even">
                    <td>示例1</td>
                    <td>
#当前wait作业所在dag_id=dag_wait,若execution_date='2017-02-04 05:06:07'<br>
#示例1:依赖作业[dag_id.task_id]在同一天内,已执行成功过;<br>
#依赖作业[dag_id.task_id]的execution_date[2017-02-04,2017-02-05)范围内，有成功执行<br>
waits['dag_id']='dag_biz_load_data'<br>
waits['task_id']='task_prd_fact_orders'<br>
                    </td>
                </tr>

                <tr class="row-odd">
                    <td>示例2</td>
                    <td>
#示例2:依赖作业[dag_id.task_id]在同一个月内,已执行成功过;<br>
#依赖作业[dag_id.task_id]的execution_date[2017-02-01,2017-03-01)范围内，有成功执行<br>
waits['frequency']='monthly'<br>
waits['dag_id']='dag_biz_load_data'<br>
waits['task_id']='task_prd_fact_orders'<br>
                    </td>
                </tr>


                <tr class="row-even">
                    <td>示例3</td>
                    <td>
#示例3:依赖作业[dag_id.task_id]的自定义时间范围内，有成功执行<br>
#from dateutil.relativedelta import relativedelta   已import<br>
waits['frequency']='custom'<br>
waits['dag_id']='dag_biz_load_data'<br>
waits['task_id']='task_prd_fact_orders'<br>
waits['execution_date_begin']= (context['execution_date'] + relativedelta(months=-1,day=1)).strftime("%Y-%m-%d %H:%M:%S") <br>
waits['execution_date_end']= (context['execution_date'] + relativedelta(months=+1,day=10)).strftime("%Y-%m-%d %H:%M:%S") <br>
                    </td>
                </tr>
              
            
            
            </tbody>
        </table>
    </div>
</div>
{% endraw %}
{% endblock %}

{% block tail %}
{{ super() }}
{% endblock %}
